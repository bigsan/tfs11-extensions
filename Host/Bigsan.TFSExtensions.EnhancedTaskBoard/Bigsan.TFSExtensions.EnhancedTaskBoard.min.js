TFS.module("Bigsan.TFSExtensions.EnhancedTaskBoard",["TFS.Host"],function(){function u(){var n='<style id="etb" type="text/css">.daysAgo { float: left; padding: 0 4px; color: white; background: darkgreen; }.daysAgo.recent { background: darkred; }.wiid { }<\/style>';$("head").append(n)}function n(n){var i=$("#tile-"+n),t=$("#taskboard-table_p"+n),r=t.closest(".taskboard-row").next();i.add(t).add(r).each(function(t,i){$(i).find(".wiid").length==0&&$(i).find(".witTitle").prepend("<strong class='wiid' /> -"),$(i).find(".witTitle .wiid").text(n)})}function f(t){$.each(t,function(t,i){n(i)})}function t(n,t){var e=(new Date).getTime()-t.getTime(),u=Math.ceil(e/864e5),i=$("<div class='daysAgo'>"+u+"d<\/div>").attr("title",t.toString()),r,f;u<2&&i.addClass("recent"),$("#tile-"+n).find(".witExtra").prepend(i),r=$("#taskboard-table_p"+n),f=r.closest(".taskboard-row").next(),r.add(f).find(".witTitle").prevAll().remove().end().before(i)}function e(){return $(".tbTile, .taskboard-parent[id]").map(function(n,t){return t.id.match(/\d+$/)[0]}).get()}function o(n){var t=location.pathname.match(/\/tfs\/[^\/]+/i)[0],i=$.map(n,function(n){return"ids="+n}).join("&");return t+"/_api/_wit/workitems?__v=1&"+i}function s(n,t){var i=o(n);$.getJSON(i,function(n){t(n.__wrappedArray)})}var i=e(),r;s(i,function(n){var i=new Date;$.each(n,function(n,i){var r=i.fields["-3"],u=parseInt(i.fields["3"].match(/\d+/)[0],10),f=new Date(u);t(r,f)})}),u(),f(i),r=TFS.OM.TfsTeamProjectCollection.getDefault().getService(TFS.WorkItemTracking.WorkItemStore).workItemManager,r.attachWorkItemChanged(function(i,r){if(r.change=="reset"||r.change=="save-completed"){var u=r.workItem,f=u.getFieldValue("System.Id"),e=u.getFieldValue("System.ChangedDate").value;window.setTimeout(function(){n(f),t(f,e)},500)}})})